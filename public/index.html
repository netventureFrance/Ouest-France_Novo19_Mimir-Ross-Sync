<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ouest-France | Novo 19 - ROSS Manager</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-main">
                <h1>
                    <span>Ouest-France</span>
                    <span class="brand-divider">|</span>
                    <span class="brand-novo">Novo 19</span>
                </h1>
            </div>
            <div class="header-right">
                <div class="header-subtitle">
                    <span style="color: #6F00FF; font-weight: 500;">Mimir Graphics Assets Manager</span>
                </div>
                <div class="header-info">
                    <span class="version">v1.0</span>
                    <span class="separator">‚Ä¢</span>
                    <span class="update-time">Mis √† jour: <span id="lastUpdate">-</span></span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">
                Dashboard
            </button>
            <button class="tab-btn" onclick="switchTab('actions')">
                Actions
            </button>
            <button class="tab-btn" onclick="switchTab('configuration')">
                Configuration
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- Statistics Panel -->
            <div class="card stats-card" style="margin-bottom: 1.5rem;">
                <h2>Monitor</h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-icon">‚úì</div>
                        <div class="stat-content">
                            <div class="stat-value" id="serverStatusValue">
                                <span class="status-dot running server-heartbeat"></span>
                                <span>Online</span>
                            </div>
                            <div class="stat-label">Server Status</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">‚è±</div>
                        <div class="stat-content">
                            <div class="stat-value" id="uptime">0h 0m</div>
                            <div class="stat-label">Server Uptime</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üåê</div>
                        <div class="stat-content">
                            <div class="stat-value" id="dashboardTunnelStatus">
                                <span class="status-dot stopped" id="dashboardTunnelDot"></span>
                                <span id="dashboardTunnelText">Stopped</span>
                            </div>
                            <div class="stat-label">Cloudflare Tunnel</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üîó</div>
                        <div class="stat-content">
                            <div class="stat-value" id="mimirWebhookStatus">
                                <span class="status-dot stopped" id="webhookStatusDot"></span>
                                <span id="webhookStatusText">Not Synced</span>
                            </div>
                            <div class="stat-label" style="color: white; font-weight: 600;">Mimir Webhook</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üåç</div>
                        <div class="stat-content">
                            <div class="stat-value" id="monitorWebhookUrl" style="font-size: 0.8rem; word-break: break-all;">-</div>
                            <div class="stat-label">Webhook URL</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="localFiles">-</div>
                            <div class="stat-label">Local Files</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">‚òÅ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="rossFolderItems">-</div>
                            <div class="stat-label"><span id="dashboardFolderName" style="color: #6F00FF; font-weight: 600;">ROSS</span> Folder Items</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="storageUsed">-</div>
                            <div class="stat-label">Storage Used</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Logs Panel -->
            <div class="card logs-card">
                <div class="logs-header">
                    <h2>Live Logs</h2>
                    <div class="logs-controls">
                        <button class="btn btn-small btn-log-control" onclick="toggleAutoScroll()">
                            <span id="autoScrollText">Auto-scroll: ON</span>
                        </button>
                        <button class="btn btn-small btn-log-control" onclick="refreshLogs()">
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="logs-container" id="logsContainer">
                    <div class="log-loading">Loading logs...</div>
                </div>
            </div>
        </div>

        <!-- Actions Tab -->
        <div id="actions-tab" class="tab-content">
            <div class="card">
                <h2>Actions</h2>
                <div class="button-group">
                    <button class="btn btn-action btn-primary" onclick="openMimirUpload()">
                        Upload to Mimir
                    </button>
                    <button class="btn btn-action" onclick="syncNow()">
                        Sync All Files
                    </button>
                    <button class="btn btn-action" onclick="viewFiles()">
                        View Downloaded Files
                    </button>
                    <button class="btn btn-action btn-warning" onclick="restartServer()">
                        Restart Server
                    </button>
                    <button class="btn btn-action" onclick="clearLogs()">
                        Clear Logs
                    </button>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="configuration-tab" class="tab-content">
            <div class="card" style="margin-bottom: 3rem;">
                <h2>Webhook URL</h2>

                <div class="form-group">
                    <label>Cloudflare Tunnel</label>
                    <div class="tunnel-controls">
                        <div class="tunnel-status">
                            <span class="tunnel-status-indicator" id="tunnelStatus">
                                <span class="status-dot stopped"></span>
                                <span id="tunnelStatusText">Stopped</span>
                            </span>
                            <span class="tunnel-url" id="tunnelUrlDisplay">-</span>
                        </div>
                        <div class="tunnel-buttons">
                            <button class="btn btn-small btn-success" onclick="startTunnel()" id="startTunnelBtn">
                                Start Tunnel
                            </button>
                            <button class="btn btn-small btn-danger" onclick="stopTunnel()" id="stopTunnelBtn" disabled>
                                Stop Tunnel
                            </button>
                        </div>
                    </div>
                    <small>Manage Cloudflare Tunnel from the GUI</small>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="webhookUrl">Webhook Endpoint</label>
                    <div class="webhook-url">
                        <input type="text" id="webhookUrl" readonly
                               value="http://localhost:3000/webhook/mimir-ross">
                        <button class="btn btn-small btn-primary" onclick="copyWebhookUrl()">Copy</button>
                    </div>
                    <small>Configure this URL in Mimir Settings ‚Üí Webhooks</small>
                </div>
            </div>

            <div class="card">
                <h2>Configuration</h2>
                <form id="configForm">
                    <div class="form-group">
                        <label>Folder Name</label>
                        <div class="folder-name-display">
                            <span id="rossFolderName" class="folder-name-value">Loading...</span>
                            <button type="button" class="btn btn-small btn-browse" onclick="syncFolderName()">
                                Sync
                            </button>
                        </div>
                        <small>Name of the folder in Mimir</small>
                    </div>

                    <div class="form-group">
                        <label for="rossFolderId">Folder ID</label>
                        <input type="text" id="rossFolderId" name="rossFolderId"
                               placeholder="f082cd14-7d20-4538-aec3-ae01ba15c296">
                        <small>UUID of the folder</small>
                    </div>

                    <div class="form-group">
                        <label for="apiKey">Mimir API Key</label>
                        <input type="password" id="apiKey" name="apiKey"
                               placeholder="sakm.xxxxxxxxxx">
                        <small>Your Mimir authentication token</small>
                    </div>

                    <div class="form-group">
                        <label for="downloadDir">Download Directory</label>
                        <div class="input-with-browse">
                            <input type="text" id="downloadDir" name="downloadDir"
                                   placeholder="ROSS_Images" readonly>
                            <button type="button" class="btn btn-small btn-browse" onclick="openFolderBrowser()">
                                Browse...
                            </button>
                        </div>
                        <small>Local folder for downloaded files</small>
                    </div>

                    <div class="form-group">
                        <label for="port">Server Port</label>
                        <input type="number" id="port" name="port"
                               placeholder="3000" min="1024" max="65535">
                        <small>Local server port</small>
                    </div>

                    <div class="form-group">
                        <label for="heartbeatInterval">Heartbeat Interval (minutes)</label>
                        <div class="input-with-buttons">
                            <input type="number" id="heartbeatInterval" name="heartbeatInterval"
                                   placeholder="5" min="1" max="60">
                            <div class="input-buttons">
                                <button type="button" class="btn-nudge" onclick="nudgeHeartbeat(1)">+1m</button>
                                <button type="button" class="btn-nudge" onclick="nudgeHeartbeat(-1)">-1m</button>
                            </div>
                        </div>
                        <small>Server status log interval (default: 5 minutes)</small>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="loadConfig()">
                            Load Current
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Save Configuration
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- File Gallery Modal -->
    <div id="fileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Downloaded Files</h2>
                <button class="modal-close" onclick="closeFileModal()">&times;</button>
            </div>
            <div id="fileGallery" class="file-gallery">
                <div class="loading">Loading files...</div>
            </div>
        </div>
    </div>

    <!-- Folder Browser Modal -->
    <div id="folderBrowserModal" class="modal">
        <div class="modal-content folder-browser-modal">
            <div class="modal-header">
                <h2>Select Download Directory</h2>
                <button class="modal-close" onclick="closeFolderBrowser()">&times;</button>
            </div>
            <div class="folder-browser">
                <div class="current-path">
                    <label>Current Path:</label>
                    <input type="text" id="currentPathInput" readonly>
                </div>
                <div class="folder-list" id="folderList">
                    <div class="loading">Loading folders...</div>
                </div>
                <div class="folder-browser-actions">
                    <button class="btn btn-secondary" onclick="closeFolderBrowser()">Cancel</button>
                    <button class="btn btn-primary" onclick="selectCurrentFolder()">Select This Folder</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
